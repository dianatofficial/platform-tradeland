<div class="max-w-4xl mx-auto">
  <div class="flex items-center justify-between mb-6">
    <h1 class="text-3xl font-bold text-gray-800">{{ pageTitle() }}</h1>
    <a routerLink="/admin/courses" class="ios-button bg-gray-200 text-gray-800 hover:bg-gray-300 flex items-center gap-2">
      <i data-lucide="arrow-right" class="w-5 h-5"></i>
      <span>بازگشت به لیست</span>
    </a>
  </div>

  <div class="ios-card">
    <form class="p-6 space-y-6" [formGroup]="courseForm" (ngSubmit)="onSubmit()" novalidate>
      
      <!-- Title -->
      <div>
        <label for="title" class="block text-sm font-medium text-gray-700">عنوان دوره</label>
        <input type="text" id="title" formControlName="title" 
               class="mt-1 block w-full border rounded-lg px-4 py-2 focus:ring-blue-500 focus:border-blue-500"
               [class.border-red-500]="title?.invalid && (title?.dirty || title?.touched)"
               [class.border-gray-300]="!title?.invalid || (!title?.dirty && !title?.touched)">
        @if (title?.invalid && (title?.dirty || title?.touched)) {
          <div class="mt-1 text-xs text-red-600">
            @if (title?.errors?.['required']) {
              <p>عنوان دوره الزامی است.</p>
            }
          </div>
        }
      </div>
      
      <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
        <!-- Instructor -->
        <div>
          <label for="instructorId" class="block text-sm font-medium text-gray-700">مدرس</label>
          <select id="instructorId" formControlName="instructorId" class="mt-1 block w-full border rounded-lg px-4 py-2 bg-white focus:ring-blue-500 focus:border-blue-500"
            [class.border-red-500]="instructorId?.invalid && (instructorId?.dirty || instructorId?.touched)"
            [class.border-gray-300]="!instructorId?.invalid || (!instructorId?.dirty && !instructorId?.touched)">
              <option [ngValue]="null" disabled>یک مدرس انتخاب کنید</option>
              @for (instructor of instructors(); track instructor.id) {
                <option [value]="instructor.id">{{ instructor.fullName }}</option>
              }
          </select>
          @if (instructorId?.invalid && (instructorId?.dirty || instructorId?.touched)) {
            <div class="mt-1 text-xs text-red-600">
              <p>انتخاب مدرس الزامی است.</p>
            </div>
          }
        </div>

        <!-- Price -->
        <div>
          <label for="price" class="block text-sm font-medium text-gray-700">قیمت (به تومان)</label>
          <input type="text" id="price" formControlName="price" 
                 class="mt-1 block w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-blue-500 focus:border-blue-500" 
                 placeholder="مثلا: ۱,۵۰۰,۰۰۰"
                 [class.border-red-500]="price?.invalid && (price?.dirty || price?.touched)"
                 [class.border-gray-300]="!price?.invalid || (!price?.dirty && !price?.touched)">
          @if (price?.invalid && (price?.dirty || price?.touched)) {
            <div class="mt-1 text-xs text-red-600">
              @if (price?.errors?.['required']) {
                <p>قیمت الزامی است.</p>
              }
            </div>
          }
        </div>
      </div>

      <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
        <!-- Level -->
        <div>
          <label for="level" class="block text-sm font-medium text-gray-700">سطح دوره</label>
          <select id="level" formControlName="level" class="mt-1 block w-full border border-gray-300 rounded-lg px-4 py-2 bg-white focus:ring-blue-500 focus:border-blue-500">
            <option>مقدماتی</option>
            <option>متوسط</option>
            <option>پیشرفته</option>
            <option>مقدماتی تا پیشرفته</option>
            <option>همه سطوح</option>
          </select>
        </div>

        <!-- Category -->
        <div>
          <label for="categoryId" class="block text-sm font-medium text-gray-700">دسته بندی</label>
          <select id="categoryId" formControlName="categoryId" class="mt-1 block w-full border rounded-lg px-4 py-2 bg-white focus:ring-blue-500 focus:border-blue-500"
            [class.border-red-500]="categoryId?.invalid && (categoryId?.dirty || categoryId?.touched)"
            [class.border-gray-300]="!categoryId?.invalid || (!categoryId?.dirty && !categoryId?.touched)">
            <option [ngValue]="null" disabled>یک دسته بندی انتخاب کنید</option>
            @for (cat of courseCategories(); track cat.id) {
              <option [value]="cat.id">{{ cat.name }}</option>
            }
          </select>
           @if (categoryId?.invalid && (categoryId?.dirty || categoryId?.touched)) {
            <div class="mt-1 text-xs text-red-600">
              <p>انتخاب دسته بندی الزامی است.</p>
            </div>
          }
        </div>

        <!-- Duration -->
        <div>
          <label for="duration" class="block text-sm font-medium text-gray-700">مدت زمان دوره</label>
          <input type="text" id="duration" formControlName="duration" 
                 class="mt-1 block w-full border rounded-lg px-4 py-2 focus:ring-blue-500 focus:border-blue-500" 
                 placeholder="مثلا: ۲۰ ساعت"
                 [class.border-red-500]="duration?.invalid && (duration?.dirty || duration?.touched)"
                 [class.border-gray-300]="!duration?.invalid || (!duration?.dirty && !duration?.touched)">
          @if (duration?.invalid && (duration?.dirty || duration?.touched)) {
            <div class="mt-1 text-xs text-red-600">
              @if (duration?.errors?.['required']) {
                <p>مدت زمان الزامی است.</p>
              }
            </div>
          }
        </div>
      </div>
       
       <!-- Image URL -->
      <div>
        <label for="imageUrl" class="block text-sm font-medium text-gray-700">آدرس تصویر شاخص</label>
        <input type="text" id="imageUrl" formControlName="imageUrl" 
               class="mt-1 block w-full border rounded-lg px-4 py-2 focus:ring-blue-500 focus:border-blue-500 ltr text-left"
               placeholder="https://example.com/image.jpg">
        <p class="mt-1 text-xs text-gray-500">در صورت خالی گذاشتن، یک تصویر تصادفی استفاده خواهد شد.</p>
      </div>

      <!-- Description -->
      <div>
        <label for="description" class="block text-sm font-medium text-gray-700">توضیحات دوره</label>
        <app-rich-text-editor formControlName="description"></app-rich-text-editor>
        @if (description?.invalid && (description?.dirty || description?.touched)) {
          <div class="mt-1 text-xs text-red-600">
            @if (description?.errors?.['required']) {
              <p>توضیحات دوره الزامی است.</p>
            }
          </div>
        }
      </div>

      <div class="flex justify-end pt-4 border-t">
        <button type="submit" [disabled]="isLoading()" class="ios-button ios-button-primary w-full sm:w-auto min-w-[120px] flex items-center justify-center">
           @if (isLoading()) {
              <svg class="animate-spin h-5 w-5 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
              </svg>
            } @else {
              <span>ذخیره تغییرات</span>
            }
        </button>
      </div>

    </form>
  </div>
</div>
